# 窗口控制功能说明

## 新增功能

### 1. Recipe窗口监测
- 自动检测 "Recipe: Setup Summary" 窗口是否存在
- 检测窗口中的 "Start Once" 按钮（control_id=1）
- 实时显示窗口状态

### 2. Recipe软件管理
- **软件路径设置**：可以浏览并选择Recipe软件的.exe文件
- **打开软件按钮**：一键启动Recipe软件
- **检查窗口按钮**：手动检查窗口是否存在

### 3. 自动控制功能
当炉温达到设定条件时，自动执行以下操作：
1. 检查Recipe窗口是否存在
2. 如果窗口不存在，弹窗提示用户打开软件
3. 自动点击 "Start Once" 按钮
4. 将质谱窗口置顶（根据设置的窗口关键字）

### 4. 质谱窗口管理
- **窗口关键字设置**：设置质谱窗口标题的关键字（用于置顶）
- 例如：如果质谱窗口标题包含 "Mass Spec" 或 "质谱仪"，就填入该关键字

## 使用步骤

### 初始设置
1. **设置Recipe软件路径**
   - 点击"浏览"按钮
   - 选择Recipe软件的.exe文件
   - 路径会自动保存

2. **设置质谱窗口关键字**
   - 在"窗口关键字"输入框中输入质谱窗口标题的关键字
   - 例如：输入 "Mass" 或 "质谱"

3. **检查窗口状态**
   - 点击"检查窗口"按钮
   - 查看窗口状态显示是否为绿色✅

### 日常使用
1. 确保Recipe软件已打开（或点击"打开Recipe软件"）
2. 连接串口并启动监控
3. 设置启动温度和触发次数
4. 当温度达到条件时，系统会：
   - 自动点击Recipe的"Start Once"按钮
   - 将质谱窗口置顶

## 窗口检测说明

程序会查找包含以下特征的窗口：
- **窗口标题**：包含 "Recipe: Setup Summary"
- **窗口类名**：#32770
- **控件类型**：Window
- **框架ID**：WIN32

按钮特征：
- **按钮名称**：Start Once
- **按钮类名**：Button
- **控件ID**：1
- **框架ID**：WIN32

## 配置文件

所有设置会自动保存到 `config/config.json`，包括：
- 串口设置
- 温度阈值和触发次数
- Recipe软件路径
- 质谱窗口关键字

## 故障排除

### 窗口检测失败
1. 确认Recipe软件已打开
2. 确认窗口标题包含 "Recipe: Setup Summary"
3. 点击"检查窗口"手动测试
4. 查看日志框中的详细错误信息

### 按钮点击失败
1. 确认窗口可见（未被最小化）
2. 确认按钮存在且可点击
3. 检查日志中的错误提示

### 质谱窗口置顶失败
1. 检查窗口关键字是否正确
2. 确认质谱窗口已打开
3. 在窗口标题栏找到关键字并填入

## 技术说明

使用的库：
- `pywinauto`：Windows UI自动化
- `PySide6`：GUI界面
- `pyserial`：串口通信

窗口查找使用 `win32` 后端，支持标准Windows控件。

