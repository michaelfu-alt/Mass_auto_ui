# PV MassSpec - 自动控制系统

## 软件简介

PV MassSpec 是一款自动化控制系统，用于监测炉温并自动触发质谱仪Recipe程序。

## 主要功能

### 1. 炉温监控
- 通过串口实时接收温度数据
- 自动判断是否达到设定条件
- 支持设定温度阈值和触发次数

### 2. Recipe自动控制
- 自动检测Recipe窗口和"Start Once"按钮
- 温度达到条件时自动点击启动按钮
- 自动将质谱窗口置顶

### 3. 设置管理
- **保存设置**：将当前参数保存到自定义文件
- **载入设置**：从文件加载之前保存的参数
- **自动保存**：程序会自动记住上次的配置

## 使用流程

### 第一步：准备Recipe软件

1. 手动打开Recipe软件
2. 确保"Recipe: Setup Summary"窗口可见
3. 点击界面顶部黄色区域的 **"✅ 我已打开Recipe，确认窗口"** 按钮
4. 日志窗口会显示：
   - 🟢 绿色：找到窗口和按钮 → 成功
   - 🔴 红色：未找到 → 请检查Recipe软件是否正确打开

### 第二步：配置参数

**串口设置：**
- 选择正确的串口端口（如 COM3）
- 点击"连接"按钮

**启动条件设置：**
- **启动温度 m (℃)**：温度达到此值时触发
- **触发次数 n**：连续n次达到温度才执行
- 点击"设定条件"保存

**质谱窗口设置（可选）：**
- 输入质谱窗口标题的关键字
- 用于自动将质谱窗口置顶

### 第三步：启动监控

1. 点击 **"启动监控"** 按钮
2. 程序开始接收温度数据
3. 日志窗口实时显示温度和状态
4. 当温度达到条件时，自动：
   - 点击Recipe的"Start Once"按钮
   - 将质谱窗口置顶（如果已设置）

## 设置管理功能

### 💾 保存设置

点击右上角的 **"💾 保存设置"** 按钮：
1. 弹出文件保存对话框
2. 选择保存位置和文件名（如：`实验A设置.json`）
3. 点击保存

保存内容包括：
- 串口端口
- 启动温度
- 触发次数
- 质谱窗口关键字

### 📂 载入设置

点击右上角的 **"📂 载入设置"** 按钮：
1. 弹出文件选择对话框
2. 选择之前保存的设置文件
3. 点击打开

程序会自动应用所有设置，并保存为当前默认配置。

### 使用场景示例

**场景1：不同实验配置**
```
实验A.json → 温度200℃, 触发2次
实验B.json → 温度300℃, 触发3次
实验C.json → 温度250℃, 触发1次
```

**场景2：快速切换**
```
1. 做实验A时，载入"实验A.json"
2. 做实验B时，载入"实验B.json"
3. 无需手动输入参数
```

## 调试工具

### 🔍 列出所有控件
- 查看Recipe窗口的所有控件信息
- 用于排查问题

### 🧪 测试点击按钮
- 手动测试自动点击功能
- 验证Recipe按钮是否能正常触发

## 日志说明

日志窗口使用颜色区分不同类型的信息：

- 🟢 **绿色**：成功操作
  - ✅ Recipe窗口已找到
  - ✅ 成功点击按钮
  - ✅ 设置已保存

- 🔴 **红色**：错误或失败
  - ❌ 未找到窗口
  - ❌ 点击失败
  - ❌ 设置载入失败

- 🟡 **黄色**：警告
  - ⚠️ 窗口置顶失败

- 🔵 **蓝色**：提示信息
  - 🔥 温度触发条件满足

### 日志操作

- **📋 复制日志**：将所有日志复制到剪贴板
- **🗑️ 清空日志**：清空日志窗口

## 配置文件

### 自动配置文件
- 位置：`config/config.json`
- 自动保存上次使用的设置
- 启动时自动加载

### 用户设置文件
- 位置：用户自定义（通过保存设置功能）
- 格式：JSON
- 可以保存多个不同的配置

### 配置文件格式示例

```json
{
  "串口端口": "COM3",
  "启动温度(℃)": "200.0",
  "触发次数": "2",
  "质谱窗口关键字": "Mass"
}
```

## 常见问题

### Q1: 找不到Recipe窗口？
**A:** 确保：
- Recipe软件已打开
- "Recipe: Setup Summary"窗口可见（未最小化）
- 窗口标题包含"Recipe: Setup Summary"

### Q2: 按钮点击没反应？
**A:** 
1. 点击"测试点击按钮"验证功能
2. 查看日志中的错误信息
3. 点击"列出所有控件"检查按钮是否存在

### Q3: 设置保存在哪里？
**A:** 
- 自动配置：`Mass_auto_ui/config/config.json`
- 用户设置：自定义位置（保存时选择）

### Q4: 如何备份我的设置？
**A:** 
1. 点击"💾 保存设置"
2. 保存到安全位置（如U盘、云盘）
3. 需要时随时载入

## 技术支持

### 系统要求
- Windows 10/11
- Python 3.14+
- 串口设备

### 依赖库
- PySide6（GUI）
- pywinauto（窗口自动化）
- pyserial（串口通信）

### 联系信息
如有问题，请查看日志文件或联系技术支持。

